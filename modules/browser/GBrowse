#!/usr/bin/env bash

export project
export object
export name

project=$(echo "$QUTE_URL" | sed -En 's@https://github.com/[^/]+/([^/]+)/.*@\1@p')

case "$QUTE_MODE" in
  hints)
    object=$(echo "$QUTE_URL" | sed -En 's@https://github.com/.*/commits?/([[:xdigit:]]{40}).*@\1@p')
    name=$(echo "$QUTE_SELECTED_HTML" | sed -En 's@.*title="([^"]+)".*@\1@p')
    ;;

  command)
    object=$(echo "$QUTE_URL" | sed -En 's@https://github.com/.*/blob/([[:xdigit:]]{40}).*@\1@p')
    ;;
esac

if [ -n "$project" ]; then
  if [ -n "$object" ]; then
    vim --servername "$project" --remote-send ":<c-u>G show $object<cr>"
  elif [ -n "$name" ]; then
    vim --servername "$project" --remote-send ":<c-u>edit $name<cr>"
  else
    exit 1
  fi
fi
